/**
 * Creation Module
 */

app.module('Create', function( module, app ) {
    
    module.addInitializer( function() {
	console.log("INIT: Create module");
	_drawForms();
    });

    // private vars
    // ------------
    var oGameView;
    var oSystemView;

    // private functions
    // -----------------

    function _drawForms() {
	console.log("drawing the create forms!");
	oGameView = new oViews.CreateGame();
	oGameView.render();
	oSystemView = new oViews.CreateSystem();
	oSystemView.render();
	$('#create-forms-container').append(oGameView.el).append(oSystemView.el);
    }

    // Views
    // -----
    var oViews = {};
    
    // Create a Game
    oViews.CreateGame = Marionette.ItemView.extend({
	tagName: 'div',
	className: 'col-sm-6 col-xs-12',
	template: window.TPL['game-create'],
	events: {
	    'submit form': 'formSubmit'
	},
	formSubmit: function(e) {
	    e.preventDefault();
	    console.log("Create a new game!!!!!!");
	    var checkboxes = [
		'is_complete',
		'has_case',
		'has_docs',
		'is_ghit',
		'is_limited',
		'is_broken'
	    ];
	    var inputs = [
		'name',
		'sysid',
		'release',
		'comment'
	    ];
	    // set model with data from the form
	    var model = new app.Models.Game();
	    var $form = this.$el.find('.form-create-game');
	    _.each(checkboxes, function(cboxName) {
		var elname = '[name=' + cboxName + ']';
		var value;
		if( $form.find(elname).prop('checked') ) {
		    value = "1";
		} else {
		    value = "0";
		}
		model.set(cboxName, value);
	    }, this);
	    _.each(inputs, function(inputName) {
		var elname = '[name=' + inputName + ']';
		var value = $form.find(elname).val();
		model.set(inputName, value);
	    }, this);
	    console.log('Save button was clicked for a Game!');
	    model.save();
	    this.trigger('done');
	}
    });

    // Create a System
    oViews.CreateSystem = Marionette.ItemView.extend({
	tagName: 'div',
	className: 'col-sm-6 col-xs-12',
	template: window.TPL['system-create']
    });

});
